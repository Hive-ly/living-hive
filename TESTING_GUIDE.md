# Testing Guide: Dynamic vs Hard-coded Embeddings

This guide walks you through testing both dynamic (real API) and hard-coded embedding modes.

## Prerequisites

1. **Install dependencies** (if not already installed):

   ```bash
   npm install
   ```

2. **Set up OpenAI API Key**:
   Create a `.env.local` file in the root directory:
   ```bash
   VITE_OPENAI_API_KEY=sk-your-openai-api-key-here
   ```

## Step 1: Generate Stories (Optional)

If you want to use Reddit stories instead of the default ones:

```bash
npm run fetch-stories
```

This will:

- Fetch ~150 stories from r/work subreddit
- Sanitize them using OpenAI (remove NSFW, personal info, etc.)
- Save ~100 clean stories to `examples/src/data/sampleStories.json`

**Note:** This requires your OpenAI API key and may take a few minutes.

## Step 2: Generate Pre-computed Embeddings

Generate embeddings for your stories and save them as reusable data:

```bash
npm run regenerate-embeddings
```

This will:

- Read stories from `examples/src/data/sampleStories.json` (or fall back to BasicExample stories)
- Generate embeddings using OpenAI API
- Save embeddings to `examples/src/data/mockEmbeddings.json`

**Note:** This requires your OpenAI API key and may take a few minutes depending on the number of stories.

## Step 3: Test Dynamic Embeddings (Real API Calls)

1. **Make sure you have `VITE_OPENAI_API_KEY` set** in `.env.local`

2. **Start the dev server**:

   ```bash
   npm run dev
   ```

3. **Open the Basic Example** in your browser

4. **What to expect**:
   - The component will make real API calls to OpenAI
   - You'll see loading states while embeddings are generated
   - Embeddings are cached (ref-based) so subsequent renders won't regenerate them
   - Check the browser console/network tab to see API calls

## Step 4: Test with Pre-computed Embeddings (No API Calls)

1. **Generate embeddings and themes** once using the scripts from Steps 1 and 2

2. **Start (or restart) the dev server**:

   ```bash
   npm run dev
   ```

3. **Open the Basic Example** in your browser

4. **What to expect**:
   - No API calls to OpenAI (check network tab)
   - Instant loading (embeddings loaded from JSON)
   - Much faster initial load

## Quick Comparison

| Feature          | Dynamic Embeddings               | Pre-computed Embeddings |
| ---------------- | -------------------------------- | ----------------------- |
| API Calls        | Yes (OpenAI)                     | No                      |
| Initial Load     | ~10 seconds (22 stories)         | Instant                 |
| Requires API Key | Yes                              | No (for viewing)        |
| Use Case         | Development, realtime validation | Production demos        |

## Troubleshooting

### Pre-computed embeddings not loading

- Make sure `mockEmbeddings.json` exists and has data
- Run `npm run regenerate-embeddings` to generate embeddings
- Check that story IDs in `sampleStories.json` match the IDs used in `BasicExample.tsx`

### API calls still happening unexpectedly

- Confirm `examples/src/data/mockEmbeddings.json` exists and matches your stories
- Restart the dev server after regenerating data
- Check browser console for any errors

### Stories not found

- If `sampleStories.json` doesn't exist, the script will fall back to extracting stories from `BasicExample.tsx`
- Or run `npm run fetch-stories` first to generate stories

## Files Reference

- `examples/src/data/sampleStories.json` - Story data (generated by `fetch-stories`)
- `examples/src/data/mockEmbeddings.json` - Pre-computed embeddings (generated by `regenerate-embeddings`)
- `examples/src/examples/BasicExample.tsx` - Example component that uses both modes
- `.env.local` - Environment variables (not committed to git)
